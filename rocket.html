<!DOCTYPE html>
<html>
<head>
	<title>
		Rocket
	</title>
	<script type="text/javascript" src="d3.min.js"></script>
	<style type="text/css">
		@keyframes starsMove {
		  0% { 
			  	-ms-transform: translate(50px,100px); /* IE 9 */
	   			 -webkit-transform: translate(50px,100px); /* Safari */
	    		transform: translate(50px,100px); /* Standard syntax */ 
    		}
		  25% { 
			  	-ms-transform: translate(80px,300px); /* IE 9 */
	   			 -webkit-transform: translate(80px,300px); /* Safari */
	    		transform: translate(80px,300px); /* Standard syntax */ 
    		}
		  50% { 
			  	-ms-transform: translate(150px,350px); /* IE 9 */
	   			 -webkit-transform: translate(150px,350px); /* Safari */
	    		transform: translate(150px,350px); /* Standard syntax */ 
    		}
		  100% { 
			  	-ms-transform: translate(50px,200px); /* IE 9 */
	   			 -webkit-transform: translate(50px,200px); /* Safari */
	    		transform: translate(50px,200px); /* Standard syntax */ 
    		}
		} 

		/*.star {
			  animation: starsMove  10s ease infinite;
			}*/
	</style>
	
</head>
<body>
<button id="start">Start</button>
<button id="stop">Stop</button>
<script type="text/javascript">
	let dataset = [];

	//rate 1:10m

	//atmosphere is 500km => 500km = 500 *1000m  => 500 000px
	const h = 30000;
	const w = 1200;
	const rocketHeight = 50;
	const distanceToFly = 2000; //km to fly for the rocker
	const universeWidth = 1200;


	const svg = d3.select("body").append("svg");

   	svg .attr("width", 900)
   		.attr("height", 500)
   		.attr("preserveAspectRatio", "xMidYMin "+ "slice")
   		.attr("viewBox", " " + 0 + " "+ 29900 + " " + w + " " + h + " ")
   		.attr("viewBox", " " + 0 + " "+ ((h-rocketHeight)- 40) + " " + w + " " + h + " ");

   	//scale spheres here 
   	//MAYBY?????
   	
   	/*var scale = d3.scale.linear()
   					//distance
                    .domain([1, 200])
                    //svg height
                    .range([1, 600]);*/

    //create defs
    var skyGradient = svg.append("defs")
    .append("linearGradient")
    .attr("id", "skyGradient")
    .attr("x1", "0.5")
    .attr("x2", "0.5")
    .attr("y1", "1")
    .attr("y2", "0.9");

    skyGradient
    .append("stop")	
    .attr("offset", "0%")
    .attr("stop-color", "lightblue");
    
    skyGradient
    .append("stop")
    .attr("offset", "100%")
    .attr("stop-color", "darkblue");


   	const mainGroup = svg.append("g");

   	const backgroundSky = mainGroup
   			.append("rect")
   			.attr("x", 0)
   			.attr("y", 0)
   			.attr("height", h)
   			.attr("width", w)
   			.attr("fill", "url(#skyGradient)");

   	const tropopauze = mainGroup.append("g"); //12 km => 12 * 1000m => 120 00m/100 => 120px
   	const stratopauze = mainGroup.append("g"); //45 km => 45 000m => 450 px
   	const mesopauze = mainGroup.append("g"); //85 km => 85 000m => 850 px
   	const thermopauze = mainGroup.append("g"); //200km > 200 0 00 = 2000 px
   	const ionosfeer = mainGroup.append("g"); //500km

   	const tropopauzeHeight = 1200;
   	const stratopauzeHeight = 4500;
   	const mesopauzeHeight = 8500;
   	const thermopauzeHeight = 20000;
   	const ionosfeerHeight = 30000;

   	tropopauze
   	.attr("id", "tropopauze")
 	.attr("transform", "translate(0," + (h-tropopauzeHeight) +")")
   	.append("rect")
   	.attr("x", 0)
   	.attr("y", 0)
   	.attr("height", tropopauzeHeight)
   	.attr("width", w)
   	.attr("fill", "transparent");


   	stratopauze
   	.attr("id", "stratopauze")
 	.attr("transform", "translate(0," + (h-stratopauzeHeight) +")")
   	.append("rect")
   	.attr("x", 0)
   	.attr("y", 0)
   	.attr("height", stratopauzeHeight-tropopauzeHeight)
   	.attr("width", w)
   	.attr("fill", "transparent");

   	mesopauze
   	.attr("id", "mesopauze")
 	.attr("transform", "translate(0," + (h-mesopauzeHeight) +")")
   	.append("rect")
   	.attr("x", 0)
   	.attr("y", 0)
   	.attr("height", mesopauzeHeight - stratopauzeHeight)
   	.attr("width", w)
   	.attr("fill", "transparent");

   	thermopauze
   	.attr("id", "thermopauze")
 	.attr("transform", "translate(0," + (h-thermopauzeHeight) +")")
   	.append("rect")
   	.attr("x", 0)
   	.attr("y", 0)
   	.attr("height", thermopauzeHeight - mesopauzeHeight)
   	.attr("width", w)
   	.attr("fill", "transparent");

   	ionosfeer
   	.attr("id", "ionosfeer")
 	.attr("transform", "translate(0," + (h-ionosfeerHeight) +")")
   	.append("rect")
   	.attr("x", 0)
   	.attr("y", 0)
   	.attr("height", ionosfeerHeight - thermopauzeHeight)
   	.attr("width", w)
   	.attr("fill", "transparent");


   	let starsGroup = ionosfeer.append("g");

   	function generateStars(num){
		let arr = [];
		for(var i = 0; i <= num; i++){
			arr.push(3);
		}
		return arr;
	}

	dataset = generateStars(500);

	function randmizeStarPosition(){
		let width = Math.floor(Math.random() * w) + 1;
		let height = Math.floor(Math.random() * (ionosfeerHeight - thermopauzeHeight)) + 1;
		return [width, height];
	}

  	
	
	d3.selectAll("circle")
		.attr("class", "star");

	
	let rocket = mainGroup
				.append("rect")
				.attr("class", "rocket")
   				.attr("x", w/2)
   				.attr("y", h-rocketHeight)
   				.attr("width", 20)
   				.attr("height", rocketHeight);

	function followRocket (yOfRocket, yOfViewPOrt, speedOfFlight, distanceOfFlight, durationOfFlight){
		//durationOfFlight = (distanceOfFlight/speedOfFlight);

		durationOfFlight = 20000;
		svg 
   		.transition()
		.duration(durationOfFlight)
		.attr("viewBox", " " + 0 + " "+ (h-distanceOfFlight-rocketHeight) + " " + w + " " + h + " ");

		d3.selectAll(".rocket")
			.transition()
			.duration(durationOfFlight)
			.attr("y", h - distanceOfFlight);

	}

	
	//followRocket (0,0, 200, 10000, 0);

	let stars = starsGroup.selectAll("circle")
                .data(dataset)
                .enter()
                .append("circle")
                .attr("cx", function(d, i) {
			        return randmizeStarPosition()[0];
			    })
       			.attr("cy", function(){
       				return randmizeStarPosition()[1];
       			})
			    .attr("r", function(d) {
			            return d;
			    })
			    //style
			    .attr("fill", "yellow");
	//loop to change dinamically coordinates of the rocket
	

	//var element = document.getElementById("SomeElementYouWantToAnimate");
	//element.style.position = 'absolute';
	
	function launchRocket(yPosition, xPosition){
		var yPos = yPosition;
		var start = null;
		var rocketFly;

		function step(timestamp) {
		  if (!start) start = timestamp;
		  var progress = timestamp - start;
		  console.log(progress);
		  
		  yPos = progress;
		  svg.attr("viewBox", " " + 0 + " "+ (h-yPos-rocketHeight) + " " + w + " " + h + " ");
		 
		  d3.selectAll(".rocket").attr("y", (h-yPos));

		  if (yPos < (30000-rocketHeight)) {
		    rocketFly = window.requestAnimationFrame(step);
		  }

		}

		window.requestAnimationFrame(step);
		document.getElementById("stop").addEventListener("click", function() {
		  cancelAnimationFrame(rocketFly);
		});
	}

	document.getElementById("start").addEventListener("click", function() {
	    launchRocket(0, 0);
	});

	


	</script>
</body>
</html>